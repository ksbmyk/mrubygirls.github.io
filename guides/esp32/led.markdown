---
layout: default
permalink: /guides/esp32/led
title: LED
---

## LED配置図

Atom Matrixの25個のLEDが組み込まれています
このLEDはWS2812というチップが使われていて、少ない配線と簡単なプログラムで、非常にカラフルでダイナミックな光の表現を可能にする、マイコン工作において最も人気のあるLEDチップです

ジグザクで1本につながっているので、以下の配置になります
```
 0  1  2  3  4
 9  8  7  6  5
10 11 12 13 14
19 18 17 16 15
20 21 22 23 24
```

## IRBで点灯

まずは1つ点灯させてみあす。
これは最初にインストールしたWS2812 gemを読み込むためのコードです。WS2812というLEDを簡単に制御できるgemを使います。

シリアルモニターで、irbを起動してください（終了していた場合は）

```
$> irb
irb>
```


```ruby
require 'ws2812'

rmt = RMTDriver.new(27)
led = WS2812.new(rmt)

led.show_rgb([255, 0, 0])
```

左上、0番目のLEDが赤になりました

show_hexメソッドを使うと16進でも色を指定できます
```ruby
led.show_hex(0xFF0000)
```


好きな色に変えてみましょう
```
# RGB値で指定
led.show_rgb([0, 255, 0])    # 緑
led.show_rgb([0, 0, 255])    # 青
led.show_rgb([255, 255, 0])  # 黄色
led.show_rgb([255, 0, 255])  # マゼンタ

# または16進数で
led.show_hex(0x00FF00)  # 緑
led.show_hex(0x0000FF)  # 青
```

複数点灯させます。指定した前から順番に0番目、2番目と解釈されていきます。

```
# RGB値で指定
led.show_rgb([255, 0, 0], [0, 255, 0], [0, 0, 255])

# または16進数で
led.show_hex(0xFF0000, 0x00FF00, 0x0000FF)
```

黒を指定することで消灯させることができます。
```
# RGB値で指定
led.show_rgb([0, 0, 0], [0, 0, 0], [0, 0, 0])

# または16進数で
led.show_hex(0x000000, 0x000000, 0x000000)
```



## ファイルを送る

長いコードをirbで書くのは大変なので（現在esp32のR2P2ではカーソルキーが使えなかったりコピー＆ペーストができなかったりします）
手元でファイルを作り、それを実行します

一度、irbを `exit` で終了し、シリアルモニターを `Ctr+]` で終了してください。

PCで以下の内容のファイルを作り、 `R2P2-ESP32/storage/home/` の下に、 `square.rb` という名前で保存してください

```ruby
require 'ws2812'

rmt = RMTDriver.new(27)
led = WS2812.new(rmt)

# 配列を使って全LEDを制御
Array.new(25) { [0, 0, 0] }  # 全て消灯

# 四隅だけ光らせる
pixels[0] = [255, 0, 0]    # 左上
pixels[4] = [0, 255, 0]    # 右上
pixels[20] = [0, 0, 255]   # 左下
pixels[24] = [255, 255, 0] # 右下

led.show_rgb(*pixels)
```




このファイルを実行します

```
./square.rb
```


四隅が違う色で光りました。


## Tips

⚠️ **警告メッセージについて**

ファイルを続けて実行すると、以下のようなメッセージが表示されることがあります

```
W (xxxxx) rmt: GPIO 27 is not usable, maybe conflict with others
```

これは警告メッセージですが、LEDの制御には問題ありません。気にせず次のステップに進んでください。

